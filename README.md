# Свободное исследование данных (EDA): транзакции и фрод (ITMO 2025)

Короткий EDA по транзакциям с формулировкой продуктовых и технических гипотез и пользы для бизнеса. Решение воспроизводится одной командой по Parquet без ETL.

## Данные
- transaction_fraud_data.parquet — транзакции с признаками и меткой is_fraud.
- historical_currency_exchange.parquet — (опционально) курсы валют для нормализации сумм.
Примечание: файлы данных не коммитятся (см. .gitignore). SQL читает Parquet напрямую через read_parquet(...)

## Как запустить
python3 -m pip install -r requirements.txt
duckdb -f sql/eda.sql | tee REPORT.md
Если имя столбца времени другое — замените в sql/eda.sql (используется timestamp).

## Итоговые находки (EDA)
- Период и объём: 2024-09-30 … 2024-10-30; 7 483 766 транзакций.
- Базовая доля фрода: 19.97%.
- High-risk vendor: ~20.00% (≈ база) — сам по себе признак слабый, полезен в сочетаниях.
- Среднее транзакций на клиента-час: 2.45.
- Часы суток: 01:00–04:59 ≈ 59% фрода; около 00:00 — ~26.7%; днём — ~9–14% → hour_of_day даёт сильный сигнал.
- Будни/выходные × «вне домашней страны»: внутри страны ~2.5%, вне страны ~56.7% → ключевой фактор — выезд из домашней страны.
- Страны (по числу мошеннических операций): Russia, Mexico, Brazil, Nigeria (≈299k); затем Australia, Japan, France, Singapore, UK, USA (≈37k).
- Города (средний чек, без плейсхолдеров): максимум у New York (~568.9).
- Активность 1 часа: у fraud-транзакций немного выше num_transactions и total_amount → полезная онлайн-фича.

## Продуктовые гипотезы
1) Онлайн-скоринг с динамическим порогом (час, «вне дома», канал/устройство, активность 1ч) с выбором порога по Expected Cost.
2) Мягкая верификация (3-DS/step-up) для сочетаний высокого риска вместо жёстких отказов.
3) Пересборка справочника high-risk продавцов по фактической статистике.
4) Гео-аномалии (невозможные перемещения; необычные устройства/каналы вне домашнего региона).
5) Лимиты по сегментам (ночь, «вне страны»).

## Технические гипотезы
- Онлайн-фичи с окнами 1/5/60/1440 мин (частоты, суммы, квантили, robust z-score/IQR).
- Интеракции: outside_home_country × hour_of_day, channel × device, city_size × amount.
- Граф-фичи «карта–устройство–IP–мерчант» (компоненты, degree/PageRank).
- GBDT (LightGBM/CatBoost) + калибровка; PR-AUC, Recall@FPR≤X%, Expected Cost; мониторинг дрифта (PSI).
- При мультивалютности нормализация сумм к USD по датам из historical_currency_exchange.

## Польза для бизнеса
- Точное блокирование в зонах высокого риска (ночь × «вне дома» × каналы/устройства).
- Меньше ложных отказов → выше одобрение в «зелёных» сегментах (день).
- Снижение опзатрат: ручная проверка/step-up направляются точечно.
- Быстрый прозрачный пилот: фичи легко вынести в прод; KPI: FR↓, FPR↓, Approval Rate↑, Step-Up Rate ≤ целевого, стоимость предотвращённого фрода↓.

## Структура репозитория
.
├── README.md
├── requirements.txt
├── sql/
│   ├── quick_checks.sql
│   └── eda.sql
└── REPORT.md
